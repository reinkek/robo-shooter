<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Robo-Shooter - Stanford CS225a Project</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Robo-Shooter</h1>
        <h2>A Drone-Destroying Robot</h2>
        <h3><img alt="" src="./images/qav250.jpg" height="396" width="528"></h3>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h3>
<a id="abstract" class="anchor" href="#abstract" aria-hidden="true"><span class="octicon octicon-link"></span></a>Abstract</h3>

<p>In this project our team programmed a Kuka robotic arm to track and shoot a dart at a flying quadrotor UAV. This was achieved by using task space control to position a customized rocket-launching end effector at the position and orientation that will intersect the path of the quadrotor.  An off-the-shelf USB dart launcher was hacked with custom hardware to interface with an Arduino microcontroller.  The quadrotor firmware was modified to allow autonomous position control with motion capture data transmitted by custom ground-station software.</p>

<h3>
<a id="demonstration" class="anchor" href="#demonstration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Demonstration</h3>
  <p>
    The video below shows the kuka and the autonomous quadrotor running our code.
    <center><iframe width="504" height="378" src="http://www.youtube.com/embed/_6nRyNkLTMo" frameborder="0" allowfullscreen></iframe></center>
  </p>
  <p>
    The next video below is using a toy RC helicopter for a smaller, faster target.
    <center><iframe width="504" height="378" src="http://www.youtube.com/embed/LY3bAWrVoCI" frameborder="0" allowfullscreen></iframe></center>
  </p>		
				
<h3>
<a id="methods" class="anchor" href="#methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Methods</h3>
  <p>
    We used an existing C++ Kuka API to send our desired commands the robot running ROS.  The control methodology was based in task-space, as opposed to joint-space.
  </p>
  <p>
    A USB foam rocket launcher was modified to be controlled with an arduino and a user input button as opposed to the supplied proprietary software. 
    <center><img alt="" src="./images/rocketlauncher.jpg" height="396" width="528"></center>
  </p>
  <p>
    We estimated the dynamics of the darts as they are launched by using the optitrack system to record their trajectories. A simple windowed average was used to smooth calculated velocity from the position data. An average launch velocity of 9m/s was found.
  </p>
  <p>
    Since the Kuka client does not allow joint torque control, we cannot apply repulsive fields to avoid joint limits or singularities. One possible solution explored was to apply a task-space controller with repuslive fields to a simulated robot. The resulting joint angles from the simulation would be sent as command values to the Kuka through our client. However we were concerned that this simulation-in-the-loop control could lead to instabilitiy and would rely heavily on data speeds. Instead, we decided to limit our end effector workspace to a virtual box to avoid joint limits and singularties.

<h3>
<a id="optimizer" class="anchor" href="#optimizer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optimal Trajectory Prediction</h3>
  <p>
	In order to account for the motion of the target, an optimizer was written to satisfy the the vector equation:
    <center><img alt="" src="./images/constraints.gif" height="37"></center></p>
    <p>Where q denotes quadrotor position and velocity, ee denotes end-effector position, Vdart represents the launch velocity of the dart, bearing denotes the unit vector parallel to the launch velocity, g is the gravitational acceleration vector (adjusted to compensate for lift during flight), and tf is the time of flight of the dart.</p>
    <p>Solving this system of equations yields three remaining degrees of freedom.  Our apporach was to optimize over this nullspace using an objective function that will balance spatial movement of the end effector, rotation of the end-effector frame, and shortest time of flight:
    <center><img alt="" src="./images/objective.gif" height="24"></center></p>
    <p>Using IPOPT numerical nonlinear optimizer with full objective gradient, constraint Jacobian, and primal/dual Hessian information, the optimizer was able to consistently solve within acceptable tolerances in 4 milliseconds.  The optimizer was shown to work under simulation conditions with this control frequency.  However, during testing on the actual Kuka robot, the 250Hz control frequency produced stepped motion at a much lower frequency (below 20Hz) which made the controller useless in practice.  It seems that the Kuka software performs agressive downsampling and filtering on incoming commands.  The visible stuttering of the Kuka robot only disappeared when commands were issued at greater than 5kHz.
</p>

<h3>
<a id="autopilot" class="anchor" href="#autopilot" aria-hidden="true"><span class="octicon octicon-link"></span></a>Autonomizing the Quadrotor</h3>
  <p>
    Due to the constrained space in the robotics lab, we wanted to modify the autopilot software to be able to autonomously hold position.  To accomplish this we needed to provide the spatial position of the quadrotor because there is no GPS signal, and also a replacement for the magnetic field readings because the metal structures and electrical current significantly warp the magnetic field in the lab.  The position is easily found through a constant homogenous transform matrix,  and the magnetic field reading is found by the x-axis column vector of the body rotation matrix assuming the global X-axis is North.
    <br><br>In order to communicate this information to the quadrotor, a program was written that sends Mavlink messages through a radio transmitter.  A message with 6 floating point variables corresponding to the North-East-Down position, and the global North vector represented in current body-frame coordinates was sent to the quadrotor at 25Hz.  Onboard the quadrotor, the autopilot was reflashed with a custom version of the firmware.  We disabled all magnetometer output by modifying the drivers so that only the fake magnetometer data will be used.  The Mavlink message receiver module was modified to recieve this new message and update the data structures for position and magnetometer measurements accordingly.
    <br><br>Finally, with the data being correctly recieved, the estimators required tuning to match the new fake sensors.  The attitude estimator is an Extended Kalman Filter.  The element in the observation covariance matrix corresponding to the magnetometer was isolated and adjusted to match the improved certainty of the fake sensor.  The position estimator is a simple linear inertial filter.  The gains were increased for the position measurement corrections until the estimator response was very slightly underdamped with overshoot of around 10%.  Real time filtered attitude and position data were plotted from the quadrotor to validate the tuning and ensure the performance was satisfactory.
    <br><br>The quadrotor was successfully flown in the lab as seen in the videos below.  There is room for improvement in perfromance of the position controller that could be gained by fine-tuining the position PID gains, and adding another low-latency sensor such as an optical flow device.  Additionally, the case when the motion capture system loses track of the quadrotor (flies too high, or out of the area) was not yet handled, and would result in loss of position control stability in most cases.  During our final demo for the course we chose not to fly the autonomous quadrotor because of this possible edge case resulting in injury to a spectator.
</p>

<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p>This project was completed as a part of Stanford's CS225a Experimental Robotics, Fall Quarter 2014</p>
<p>The team members are:
<br>*Guilia Guidi (M.S. Mechanical Engineering) 
<br>*Joel Pazhayampallil (M.S. Mechanical Engineering)
<br>*Kyle Reinke (M.S. Aero/Astro Engineering)
<br>*Sagar Saxena (M.S. Mechanical Engineering).

<h3>
<a id="contact" class="anchor" href="#contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contact</h3>

<p>Please refer to the Team Members side bar above to access our LinkedIn profiles.  Thank you!</p>

<hr>
<p><small>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</small></p>
        </section>
        <aside id="sidebar">
	  <h2>Team Members</h2>
          <a href="http://www.linkedin.com/pub/giulia-guidi/42/b4a/16a/en" target="_blank">
	    <h3> Giulia </h3>
	    <img alt="" src="./images/giulia.jpg" height="150" width="150">
	  </a> 
	  <a href="http://www.linkedin.com/pub/joel-pazhayampallil/4b/315/666/en" target="_blank">
	    <h3> Joel </h3>
	    <img alt="" src="./images/joel.jpg" height="150" width="150">
	  </a> 
	  <a href="http://www.linkedin.com/in/reinkek" target="_blank">
	    <h3> Kyle </h3>
	    <img alt="" src="./images/kyle.jpg" height="150" width="150">
	  </a> 
	  <a href="http://ca.linkedin.com/pub/sagar-saxena/45/298/b23/en" target="_blank">
	    <h3> Sagar </h3>
	    <img alt="" src="./images/sagar.jpg" height="150" width="150">
	  </a> 
          
	  <hr>
          
        </aside>
      </div>
    </div>

  
  </body>
</html>
